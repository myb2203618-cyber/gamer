<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script>
    AFRAME.registerComponent('scene-switch', {
      schema: {
        target: { type: 'selector' }
      },
      init: function () {
        this.el.addEventListener('click', () => {
          // Tìm scene cha hiện tại đang chứa nút được bấm
          const currentScene = this.el.closest('a-entity[id]');
          if (currentScene) currentScene.setAttribute('visible', false);

          // Hiện scene mục tiêu
          if (this.data.target) this.data.target.setAttribute('visible', true);
        });
      }
    });
    ////////////////////////////////////////////////////////////////
    QUIZ - phancauhoi
    AFRAME.registerComponent('quiz-logic', {
      init: function () {
        this.questions = [
          { qImage: "asset/ans/c1.png", correct: 3 }, // Đáp án đúng là nút thứ 2 (index 1)
          { qImage: "asset/ans/c2.png", correct: 1 },
          { qImage: "asset/ans/c3.png", correct: 2 },
          { qImage: "asset/ans/c4.png", correct: 2 },
          { qImage: "asset/ans/c5.png", correct: 0 }
        ];

        this.currentQuestionIndex = 0;
        this.totalQuestions = 3;
        this.questions = this.questions.sort(() => Math.random() - 0.5);

        // Lấy thẻ Plane dùng để hiển thị hình ảnh câu hỏi
        this.questionDisplay = document.querySelector("#question-board");
        this.optionButtons = document.querySelectorAll(".quiz-option");

        this.optionButtons.forEach((btn, index) => {
          btn.addEventListener('click', () => this.checkAnswer(index));
        });

        this.loadQuestion();
      },

      loadQuestion: function () {
        if (this.currentQuestionIndex < this.totalQuestions) {
          const currentQ = this.questions[this.currentQuestionIndex];

          // Thay đổi hình ảnh trên tấm bảng
          this.questionDisplay.setAttribute('src', currentQ.qImage);
        } else {
          // Hoàn thành: Ẩn Quiz, Hiện Assembly
          document.querySelector("#quiz").setAttribute('visible', false);
          document.querySelector("#assembly").setAttribute('visible', true);
        }
      },

      checkAnswer: function (selectedIndex) {
        const currentQ = this.questions[this.currentQuestionIndex];
        if (selectedIndex === currentQ.correct) {
          this.currentQuestionIndex++;
          this.loadQuestion();
        } else {
          // Bạn có thể thêm hiệu ứng rung hoặc âm thanh sai ở đây
          console.log("Sai rồi!");
        }
      }
    });
  </script>
  <title>AR Quiz 5 Scenes</title>
</head>

<body>
  <a-scene mindar-image="imageTargetSrc: targets.mind" color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights: true" vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">

    <a-assets>
      <a-asset-item id="logo" src="asset/logo.glb"></a-asset-item>
      <a-asset-item id="node" src="asset/nut.glb"></a-asset-item>
      <a-asset-item id="ans" src="asset/cautraloi.glb"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;"
      raycaster="objects: .clickable"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0">

      <a-entity id="welcome" visible="true">
        <a-gltf-model src="#logo" position="0 0.4 0" scale="0.1 0.1 0.1"></a-gltf-model>
        <a-text value="WELCOME" align="center" position="0 0.7 0" color="white"></a-text>

        <a-gltf-model class="clickable" scene-switch="target: #quiz" src="#node" position="0.5 0.3 0"
          scale="0.1 0.1 0.1" rotation="0 90 0"></a-gltf-model>

        <a-gltf-model class="clickable" scene-switch="target: #leaderboard" src="#node" position="0.5 0 0"
          scale="0.1 0.1 0.1" rotation="0 90 0"></a-gltf-model>
      </a-entity>

      <a-entity id="leaderboard" visible="false">
        <a-text value="LEADERBOARD" align="center" position="0 0.5 0" color="yellow"></a-text>
        <a-gltf-model class="clickable" scene-switch="target: #welcome" src="#node" position="0 -0.5 0"
          scale="0.05 0.05 0.05"></a-gltf-model>
      </a-entity>

      <a-entity id="quiz" visible="false" quiz-logic>

        <a-plane id="question-board" position="0 0.6 0" width="1.2" height="0.6"
          material="transparent: true; shader: flat">
        </a-plane>

        <a-gltf-model class="clickable quiz-option" src="#node" position="-0.5 0 0" scale="0.1 0.1 0.1"></a-gltf-model>
        <a-gltf-model class="clickable quiz-option" src="#node" position="0 0 0" scale="0.1 0.1 0.1"></a-gltf-model>
        <a-gltf-model class="clickable quiz-option" src="#node" position="0.5 0 0" scale="0.1 0.1 0.1"></a-gltf-model>
        <!-- <a-gltf-model class="clickable quiz-option" src="#node" position="0.5 0 0" scale="0.1 0.1 0.1"></a-gltf-model> -->

      </a-entity>

      <a-entity id="assembly" visible="false">
        <a-gltf-model src="#logo" position="0 0 0" scale="0.15 0.15 0.15"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-gltf-model>
        <a-gltf-model class="clickable" scene-switch="target: #reward" src="#node" position="0 -0.5 0"
          scale="0.1 0.1 0.1"></a-gltf-model>
      </a-entity>

      <a-entity id="reward" visible="false">
        <a-text value="CHUC MUNG! BAN NHAN DUOC VOUCHER 50%" align="center" position="0 0.3 0"
          scale="0.4 0.4 0.4"></a-text>
        <a-gltf-model class="clickable" scene-switch="target: #welcome" src="#node" position="0 -0.3 0"
          scale="0.1 0.1 0.1"></a-gltf-model>
      </a-entity>

    </a-entity>
  </a-scene>
</body>

</html>